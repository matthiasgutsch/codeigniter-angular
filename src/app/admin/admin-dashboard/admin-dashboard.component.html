<div class="top-main-wrapper">

    <div class="dash-header">
        <div class="dash-title">

            <div class="p-field p-grid">
                <div class="p-col-6 p-md-6">
                    <h3>Dashboard</h3>
                </div>
                <div class="p-col-6 p-md-6">
                   

                </div>
            </div>

        </div>
    </div>
</div>


<div class="main-inner">

<div class="p-grid">

    <div class="p-col-12 p-md-12">

        <div class="p-field p-grid">

            <div class="p-col-12 p-md-3">

                <p-card>

                    <div class="p-grid">
                        <div class="p-col-6 p-md-6">

                            <h4 class="mb-0">Clienti</h4>
                            Totale: {{clientsCount}}

                        </div>

                        <div class="p-col-6 p-md-6">

                            <button pButton pRipple icon="pi pi-plus" [routerLink]="['/admin/clients/create']"
                                routerLinkActive="active" class="p-button p-button-success pull-right"></button>

                            <button pButton pRipple icon="pi pi-list" [routerLink]="['/admin/clients']"
                                routerLinkActive="active" class="p-button p-button-primary pull-right p-mr-2"></button>

                        </div>
                    </div>
                </p-card>
            </div>
            <div class="p-col-12 p-md-3">

                <p-card>

                    <div class="p-grid">
                        <div class="p-col-6 p-md-6">
                            <h4 class="mb-0">Appuntamenti</h4>
                            Totale: {{appointmentsCount}}

                        </div>
                        <div class="p-col-6 p-md-6">

                            <button pButton pRipple icon="pi pi-plus" [routerLink]="['/admin/appointments/create']"
                                routerLinkActive="active" class="p-button p-button-success pull-right"></button>
                            <button pButton pRipple icon="pi pi-list" [routerLink]="['/admin/appointments']"
                                routerLinkActive="active" class="p-button p-button-primary p-mr-2 pull-right"></button>
                        </div>
                    </div>
                </p-card>

            </div>

            <div class="p-col-12 p-md-3">

                <p-card>

                    <div class="p-grid">
                        <div class="p-col-6 p-md-6">
                            <h4 class="mb-0">Fatturazione</h4>
                            {{billingsCountTotal | currency :'EUR':'symbol':'1.2-2'}} <strong></strong>

                            <!-- <span class="red" *ngIf="billingsCountTotalNotPaid > 0"> ({{billingsCountTotalNotPaid |  currency :'EUR':'symbol':'1.2-2'}})</span> -->
                        </div>
                        <div class="p-col-6 p-md-6">

                            <button pButton pRipple icon="pi pi-plus" [routerLink]="['/admin/billings/create']"
                                routerLinkActive="active" class="p-button p-button-success pull-right"></button>
                            <button pButton pRipple icon="pi pi-list" [routerLink]="['/admin/billings']"
                                routerLinkActive="active" class="p-button p-button-primary p-mr-2 pull-right"></button>
                        </div>
                    </div>
                </p-card>
            </div>
            <div class="p-col-12 p-md-3">

                <p-card>

                    <div class="p-grid">
                        <div class="p-col-6 p-md-6">

                            <h4 class="mb-0">Prodotti</h4>
                            Totale: {{productsCount}}

                        </div>

                        <div class="p-col-6 p-md-6">

                            <button pButton pRipple icon="pi pi-plus" [routerLink]="['/admin/products/create']"
                                routerLinkActive="active" class="p-button p-button-success pull-right"></button>
                            <button pButton pRipple icon="pi pi-list" [routerLink]="['/admin/products']"
                                routerLinkActive="active" class="p-button p-button-primary pull-right p-mr-2"></button>
                        </div>
                    </div>
                </p-card>

            </div>
        </div>

    </div>

    <div class="p-col-12 p-md-6">
        <p-card>

            <div class="p-field p-grid">

                <div class="p-col-12 p-md-12">

                    <p-tabView class="responsive-tab-view">
                        <p-tabPanel header="Ultimi Prodotti">

                            <p-table #dt1 [value]="products" [responsive]="true" [paginator]="false" [rows]="10">

                                <ng-template pTemplate="body" let-rowData let-product>
                                    <tr>
                                        <td *ngIf="product.image" width="70px"><img [src]="rowData.image"
                                                [routerLink]="['/admin/products/edit', product.id]" class="img-responsive"></td>
                                        <td>
                                            <strong>{{product.title}}</strong>
                                            <div class="clearfix"></div>
                                            <p class="detail">{{product.code}} - {{product.code_int}}</p>
                                            
                                        </td>
                                        <td width="60px">
                                            <button pButton pRipple icon="pi pi-pencil" class="p-button p-button-success p-mr-2"
                                            [routerLink]="['/admin/products/edit', product.id]"></button>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>

                        </p-tabPanel>
                    </p-tabView>
                </div>
            </div>
        </p-card>

        <p-card>

            <div class="p-field p-grid">

                <div class="p-col-12 p-md-12">

                    <p-tabView class="responsive-tab-view">
                        <p-tabPanel header="Ultimi Movimenti Magazzino">

                            <p-table #dt1 [value]="warehouseCheckins" [responsive]="true" [paginator]="false" [rows]="10">

                                <ng-template pTemplate="body" let-warehouseCheckin>
                                    <tr>

                                        <td width="200">
                                            <i class="pi pi-calendar"></i> {{warehouseCheckin.created_at}}
                                         </td>
                                   
                                 
            
                              
            
                                        <td>
                                            <p-tag severity="default" [value]="warehouseCheckin.pieces + ' pezzi'" class="p-mr-2"></p-tag></td>
            
                                            <td width="80"> <img *ngIf="warehouseCheckin.image" class="img-responsive" src="{{ warehouseCheckin.image}}"></td>
                                       <td>  
                                           
                                        <p class="small"><strong>{{ warehouseCheckin.product.code_int}}</strong></p> 
                                        <p class="small" *ngIf="warehouseCheckin.supplier_id">{{ warehouseCheckin.supplier_id.company_name}}</p></td>
                                   
                                   
                                    </tr>
                                </ng-template>
                            </p-table>

                        </p-tabPanel>
                    </p-tabView>
                </div>
            </div>
        </p-card>
    </div>

    <div class="p-col-12 p-md-6">

        <p-card>

            <div class="p-field p-grid">
                <div class="p-col-12 p-md-8">
                   
                    <h3>Appuntamenti Oggi</h3>
                </div>
                <div class="p-col-12 p-md-4">

                <button pButton pRipple icon="pi pi-plus" label="aggiungi"
                class="p-button p-button-add p-mr-2 pull-right"
                [routerLink]="['/admin/appointments/create']"></button>
                </div>
            </div>
            <hr class="full">

            <p-table #dt1 [value]="appointmentsToday" [responsive]="true" [paginator]="false" [rows]="10">

                <ng-template pTemplate="body" let-appointment>
                    <tr>
                        <td width="100">
                            <p-tag value="{{appointment.time}}" severity="warning"></p-tag>
                        </td>

                        <td width="50">
                            <app-initials-avatar (click)="editProduct(appointment)"
                                firstName="{{ appointment.client.name | slice:0:1}}"
                                lastName="{{ appointment.client.surname | slice:0:1}}">
                            </app-initials-avatar>
                        </td>
                        <td> {{ appointment.client.name }}
                            {{ appointment.client.surname }}</td>

                        <td>{{appointment.title}}</td>
                    </tr>
                </ng-template>
            </p-table>

        </p-card>


        

        <p-card>

            <div class="p-field p-grid">

                <div class="p-col-12 p-md-12">

                    <p-tabView class="responsive-tab-view">
                        <p-tabPanel header="Progetti">
                            <p-table #dt1 [value]="projects" [responsive]="true" [paginator]="false" [rows]="10">

                                <ng-template pTemplate="body" let-project>
                                    <tr>

                                        <td width="50">
                                            <app-initials-avatar firstName="{{project.code_int | slice: 0:1}}"
                                                lastName="{{project.code_int | slice: 1:2}}">
                                            </app-initials-avatar>
                                        </td>

                                        <td>

                                            <strong>{{project.title}}</strong>
                                            <div class="clearifix"></div>
                                            <p class="detail">
                                            <i class="pi pi-calendar"></i> {{project.date_from}} al {{project.date_to}}
                                            </p>
                                        </td>

                                        <td width="120"><i class="pi pi-clock"></i> {{project.time}}</td>

                                        <td>

                                            <button pButton pRipple icon="pi pi-chart-line"
                                                class="p-button p-button-secondary p-mr-2"
                                                [routerLink]="['/admin/projects/productivity/', project.id]"></button>

                                            <button pButton pRipple icon="pi pi-clock"
                                                class="p-button p-button-primary p-mr-2"
                                                [routerLink]="['/admin/projects/timesheet/', project.id]"></button>

                                            <button pButton pRipple icon="pi pi-clone"
                                                class="p-button p-button-warning p-mr-2"
                                                [routerLink]="['/admin/projects/task/', project.id]"></button>

                                            <button pButton pRipple icon="pi pi-pencil"
                                                class="p-button p-button-success p-mr-2"
                                                [routerLink]="['/admin/projects/edit/', project.id]"></button>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>

                        </p-tabPanel>

                        <p-tabPanel header="Helpdesk">

                            <p-table #dt1 [value]="supports" [responsive]="true" [paginator]="false" [rows]="10">

                                <ng-template pTemplate="body" let-support>
                                    <tr>

                                        <td width="200">

                                            <p-tag severity="success" *ngIf="support.is_active === '1'"
                                                value="Ticket aperto" class="p-mr-2"></p-tag>
                                            <p-tag severity="danger" *ngIf="support.is_active === '0'"
                                                value="Ticket chiuso" class="p-mr-2"></p-tag>

                                            <p-tag value="{{support.date | date: 'dd/MM/yyyy' }}" severity="warning">
                                            </p-tag>
                                        </td>

                                        <td>{{support.title}}</td>

                                        <td width="60">
                                            <button pButton pRipple icon="pi pi-eye"
                                                class="p-button p-button-primary p-mr-2"
                                                [routerLink]="['/admin/support', support.id]"></button>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </p-tabPanel>

                    </p-tabView>

                </div>

            </div>

        </p-card>
    </div>
</div>
</div>
<p-sidebar [(visible)]="productDialog" position="right" [style]="{width:'50%'}">
    <ng-template pTemplate="content">
        <div class="p-col-12 p-md-12">
            <p-card>
                <div class="p-grid">
                    <div class="p-col-12 p-md-6">
                        <strong> {{displayEvent.event.start | date:'dd/MM/yyyy HH:mm':'-0000'}}</strong>

                        <h3>{{displayEvent.event.title}}</h3>

                        {{ displayEvent.event.client.name }}
                        <br> {{ displayEvent.event.client.surname }}

                        <p [innerHTML]="displayEvent.event.description"></p>

                    </div>
                    <div class="p-col-12 p-md-6">
                        <div *ngFor="let item of displayEvent.event.works_id">
                            {{ getWorksItem(item)?.name }}
                        </div>

                    </div>

                </div>
                <div class="clearfix"></div><br>
                <button pButton pRipple icon="pi pi-pencil" label="modifica Appuntamento"
                    class="p-button p-button-success p-mr-2"
                    [routerLink]="['/admin/appointments/edit', displayEvent.event.id]"></button>

            </p-card>
        </div>
        <div class="clearfix"></div><br>
        <div class="clearfix"></div>
        <div class="p-col-12 p-md-12">

            <p-card>
                <strong>{{ displayEvent.event.client.name }}
                    {{ displayEvent.event.client.surname }}</strong>

                <p>{{ displayEvent.event.client.address }}<br>
                    {{ displayEvent.event.client.zip }} -
                    {{ displayEvent.event.client.city }}
                    ({{ displayEvent.event.client.province }})<br>
                </p>
                <hr>
                <p>{{ displayEvent.event.client.phone }}<br>
                    {{ displayEvent.event.client.email }}</p>
                <div class="clearfix"></div>
                <div class="clearfix"></div><br>

                <button pButton pRipple icon="pi pi-pencil" label="Modifica Dati Cliente"
                    class="p-button p-button-primary p-mr-2"
                    [routerLink]="['/admin/clients/edit', displayEvent.event.category_id]"></button>
            </p-card>
        </div>

    </ng-template>

</p-sidebar>

<p-sidebar [(visible)]="appointmentsDialog" position="right" [style]="{width:'50%'}">
    <ng-template pTemplate="content">
        <div class="p-col-12 p-md-12">
            <p-card>
                <div class="p-grid">
                    <div class="p-col-12 p-md-12">
                        <div class="p-grid">
                            <div class="p-col-12 p-md-6">

                                <h3>{{appointment.title}}</h3>
                            </div>

                            <div class="p-col-12 p-md-6">

                                <p-tag [value]="appointment.date" class="p-mr-2 pull-right"></p-tag>
                                <p-tag [value]="appointment.time" severity="info" class="p-mr-2  pull-right"></p-tag>
                            </div>

                        </div>
                        <hr class="small">

                    </div>
                </div>
                <div class="p-grid">

                    <div class="p-col-12 p-md-6">

                        {{ appointment.client.name }}
                        <br> {{ appointment.client.surname }}

                        <p [innerHTML]="appointment.description"></p>

                    </div>
                    <div class="p-col-12 p-md-6">

                        <div *ngFor="let item of selectedWorks">
                            {{ getWorksItem(item)?.name }}
                        </div>

                    </div>

                </div>
                <div class="clearfix"></div><br>

                <button pButton pRipple icon="pi pi-pencil" label="modifica Appuntamento"
                    class="p-button p-button-success p-mr-2"
                    [routerLink]="['/admin/appointments/edit', appointment.id]"></button>

            </p-card>
        </div>
        <div class="clearfix"></div><br>
        <div class="clearfix"></div>
        <div class="p-col-12 p-md-12">

            <p-card>
                <strong>{{ appointment.client.name }}
                    {{ appointment.client.surname }}</strong>

                <p>{{ appointment.client.address  }}<br>
                    {{ appointment.client.zip }} -
                    {{ appointment.client.city }}
                    ({{ appointment.client.province }})<br>
                </p>
                <hr>
                <p>{{ appointment.client.phone }}<br>
                    {{ appointment.client.email }}</p>
                <div class="clearfix"></div><br>

                <button pButton pRipple icon="pi pi-pencil" label="Modifica Dati Cliente"
                    class="p-button p-button-primary p-mr-2"
                    [routerLink]="['/admin/clients/edit', appointment.category_id]"></button>
            </p-card>
        </div>

    </ng-template>

</p-sidebar>