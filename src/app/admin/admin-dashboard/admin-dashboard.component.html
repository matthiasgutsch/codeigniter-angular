<div class="dash-header">
    <div class="dash-title">

        <div class="p-field p-grid">
            <div class="p-col-12 p-md-12">
                <div class="welcome-banner">
                    <h3>Benvenuto, {{currentUser.first_name}} {{currentUser.last_name}}</h3>
                    <span>{{myDate }}</span>
                </div>
            </div>
            <div class="p-col-12 p-md-3">

            </div>
        </div>

    </div>
</div>
<div class="p-grid">

    <div class="p-col-12 p-md-12">

        <div class="p-field p-grid">

            <div class="p-col-6 p-md-3">

                <p-card>

                    <div class="p-grid">
                        <div class="p-col-12 p-md-6">

                            <h4 class="mb-0">Clienti</h4>
                            Totale: {{clientsCount}}

                        </div>

                        <div class="p-col-12 p-md-6">

                            <button pButton pRipple icon="pi pi-plus" [routerLink]="['/admin/clients/create']"
                                routerLinkActive="active" class="p-button p-button-success pull-right"></button>

                            <button pButton pRipple icon="pi pi-list" [routerLink]="['/admin/clients']"
                                routerLinkActive="active" class="p-button p-button-primary pull-right p-mr-2"></button>

                        </div>
                    </div>
                </p-card>
            </div>
            <div class="p-col-12 p-md-3">

                <p-card>

                    <div class="p-grid">
                        <div class="p-col-6 p-md-6">
                            <h4 class="mb-0">Appuntamenti</h4>
                            Totale: {{appointmentsCount}}

                        </div>
                        <div class="p-col-6 p-md-6">

                            <button pButton pRipple icon="pi pi-plus" [routerLink]="['/admin/appointments/create']"
                                routerLinkActive="active" class="p-button p-button-success pull-right"></button>
                            <button pButton pRipple icon="pi pi-list" [routerLink]="['/admin/appointments']"
                                routerLinkActive="active" class="p-button p-button-primary p-mr-2 pull-right"></button>
                        </div>
                    </div>
                </p-card>

            </div>

            <div class="p-col-12 p-md-3">

                <p-card>

                    <div class="p-grid">
                        <div class="p-col-6 p-md-6">
                            <h4 class="mb-0">Fatturazione</h4>
                            {{billingsCountTotal | currency :'EUR':'symbol':'1.2-2'}} <strong></strong>

                            <!-- <span class="red" *ngIf="billingsCountTotalNotPaid > 0"> ({{billingsCountTotalNotPaid |  currency :'EUR':'symbol':'1.2-2'}})</span> -->
                        </div>
                        <div class="p-col-6 p-md-6">

                            <button pButton pRipple icon="pi pi-plus" [routerLink]="['/admin/billings/create']"
                                routerLinkActive="active" class="p-button p-button-success pull-right"></button>
                            <button pButton pRipple icon="pi pi-list" [routerLink]="['/admin/billings']"
                                routerLinkActive="active" class="p-button p-button-primary p-mr-2 pull-right"></button>
                        </div>
                    </div>
                </p-card>
            </div>
            <div class="p-col-12 p-md-3">

                <p-card>

                    <div class="p-grid">
                        <div class="p-col-12 p-md-6">

                            <h4 class="mb-0">Prodotti</h4>
                            Totale: {{productsCount}}

                        </div>

                        <div class="p-col-12 p-md-6">

                            <button pButton pRipple icon="pi pi-plus" [routerLink]="['/admin/products/create']"
                                routerLinkActive="active" class="p-button p-button-success pull-right"></button>
                            <button pButton pRipple icon="pi pi-list" [routerLink]="['/admin/products']"
                                routerLinkActive="active" class="p-button p-button-primary pull-right p-mr-2"></button>
                        </div>
                    </div>
                </p-card>

            </div>
        </div>

    </div>

    <div class="p-col-12 p-md-6">
        <p-card>

            <p-tabView>
                <p-tabPanel header="Calendario">

                    <div *ngIf="calendarOptions">
                        <ng-fullcalendar #ucCalendar [options]="calendarOptions"
                            (eventClick)="eventClick($event.detail)" (dayClick)="dayClick($event.detail)">
                        </ng-fullcalendar>
                    </div>

                </p-tabPanel>

                <p-tabPanel header="Report Fatturazione mensile">
                    <canvas id="myChart" width="600" height="350" #mychart></canvas>

                </p-tabPanel>

            </p-tabView>

        </p-card>
    </div>

    <div class="p-col-12 p-md-6">

        <p-card>

            <div class="p-field p-grid">
                <div class="p-col-12 p-md-12">
                    <h3>Appuntamenti Oggi</h3>
                </div>

            </div>
            <hr class="full">

            <p-table #dt1 [value]="appointmentsToday" [paginator]="false" [rows]="10">

                <ng-template pTemplate="body" let-appointment>
                    <tr>
                        <td width="100">
                            <p-tag value="{{appointment.date | date: 'HH:mm' }}" severity="warning"></p-tag>
                        </td>

                        <td width="50">
                            <app-initials-avatar (click)="editProduct(appointment)"
                                firstName="{{ getCategoryItem(appointment.category_id)?.name | slice:0:1}}"
                                lastName="{{ getCategoryItem(appointment.category_id)?.surname | slice:0:1}}">
                            </app-initials-avatar>
                        </td>
                        <td> {{ getCategoryItem(appointment.category_id)?.name }}
                            {{ getCategoryItem(appointment.category_id)?.surname }}</td>

                        <td>{{appointment.title}}</td>
                    </tr>
                </ng-template>
            </p-table>

        </p-card>

        <p-card>

            <div class="p-field p-grid">

                <div class="p-col-12 p-md-12">

                    <p-tabView>
                        <p-tabPanel header="Progetti">
                            <p-table #dt1 [value]="projects" [paginator]="false" [rows]="10">

                                <ng-template pTemplate="body" let-project>
                                    <tr>

                                        <td width="50">
                                            <app-initials-avatar firstName="{{project.code_int | slice: 0:1}}"
                                                lastName="{{project.code_int | slice: 1:2}}">
                                            </app-initials-avatar>
                                        </td>

                                        <td>

                                            <strong>{{project.title}}</strong><br>{{project.code_int}}
                                            <div class="clearifix"></div>

                                        </td>

                                        <td width="120"><i class="pi pi-clock"></i> {{project.time}}</td>

                                        <td>

                                            <button pButton pRipple icon="pi pi-chart-line"
                                                class="p-button p-button-secondary p-mr-2"
                                                [routerLink]="['/admin/projects/productivity/', project.id]"></button>

                                            <button pButton pRipple icon="pi pi-clock"
                                                class="p-button p-button-primary p-mr-2"
                                                [routerLink]="['/admin/projects/timesheet/', project.id]"></button>

                                            <button pButton pRipple icon="pi pi-clone"
                                                class="p-button p-button-warning p-mr-2"
                                                [routerLink]="['/admin/projects/task/', project.id]"></button>

                                            <button pButton pRipple icon="pi pi-pencil"
                                                class="p-button p-button-success p-mr-2"
                                                [routerLink]="['/admin/projects/edit/', project.id]"></button>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>

                        </p-tabPanel>

                        <p-tabPanel header="Helpdesk">

                            <p-table #dt1 [value]="supports" [paginator]="false" [rows]="10">

                                <ng-template pTemplate="body" let-support>
                                    <tr>

                                        <td width="200">

                                            <p-tag severity="success" *ngIf="support.is_active === '1'"
                                                value="Ticket aperto" class="p-mr-2"></p-tag>
                                            <p-tag severity="danger" *ngIf="support.is_active === '0'"
                                                value="Ticket chiuso" class="p-mr-2"></p-tag>

                                            <p-tag value="{{support.date | date: 'dd/MM/yyyy' }}" severity="warning">
                                            </p-tag>
                                        </td>

                                        <td>{{support.title}}</td>

                                        <td width="60">
                                            <button pButton pRipple icon="pi pi-eye"
                                                class="p-button p-button-primary p-mr-2"
                                                [routerLink]="['/admin/support', support.id]"></button>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </p-tabPanel>

                    </p-tabView>

                </div>

            </div>

        </p-card>
    </div>
</div>

<p-sidebar [(visible)]="productDialog" position="right" [style]="{width:'50%'}">
    <ng-template pTemplate="content">
        <div class="p-col-12 p-md-12">
            <p-card>
                <div class="p-grid">
                    <div class="p-col-12 p-md-6">
                        <strong> {{displayEvent.event.start | date:'dd/MM/yyyy HH:mm':'-0000'}}</strong>

                        <h3>{{displayEvent.event.title}}</h3>

                        {{ getLocationItem(displayEvent.event.location_id)?.name }}
                        <br> {{ getEmployeeItem(displayEvent.event.employee_id)?.name }}

                        <p [innerHTML]="displayEvent.event.description"></p>

                    </div>
                    <div class="p-col-12 p-md-6">
                        <div *ngFor="let item of displayEvent.event.works_id">
                            {{ getWorksItem(item)?.name }}
                        </div>

                    </div>

                </div>
                <div class="clearfix"></div><br>
                <button pButton pRipple icon="pi pi-pencil" label="modifica Appuntamento"
                    class="p-button p-button-success p-mr-2"
                    [routerLink]="['/admin/appointments/edit', displayEvent.event.id]"></button>

            </p-card>
        </div>
        <div class="clearfix"></div><br>
        <div class="clearfix"></div>
        <div class="p-col-12 p-md-12">

            <p-card>
                <strong>{{ getCategoryItem(displayEvent.event.category_id)?.name }}
                    {{ getCategoryItem(displayEvent.event.category_id)?.surname }}</strong>

                <p>{{ getCategoryItem(displayEvent.event.category_id)?.address }}<br>
                    {{ getCategoryItem(displayEvent.event.category_id)?.zip }} -
                    {{ getCategoryItem(displayEvent.event.category_id)?.city }}
                    ({{ getCategoryItem(displayEvent.event.category_id)?.province }})<br>
                </p>
                <hr>
                <p>{{ getCategoryItem(displayEvent.event.category_id)?.phone }}<br>
                    {{ getCategoryItem(displayEvent.event.category_id)?.email }}</p>
                <div class="clearfix"></div>
                <div class="clearfix"></div><br>

                <button pButton pRipple icon="pi pi-pencil" label="Modifica Dati Cliente"
                    class="p-button p-button-primary p-mr-2"
                    [routerLink]="['/admin/clients/edit', displayEvent.event.category_id]"></button>
            </p-card>
        </div>

    </ng-template>

</p-sidebar>

<p-sidebar [(visible)]="appointmentsDialog" position="right" [style]="{width:'50%'}">
    <ng-template pTemplate="content">
        <div class="p-col-12 p-md-12">
            <p-card>
                <div class="p-grid">
                    <div class="p-col-12 p-md-6">
                        <strong>{{appointment.date | date:'dd/MM/yyyy HH:mm'}}</strong>

                        <h3>{{appointment.title}}</h3>

                        {{ getLocationItem(appointment.location_id)?.name }}
                        <br> {{ getEmployeeItem(appointment.employee_id)?.name }}

                        <p [innerHTML]="appointment.description"></p>

                    </div>
                    <div class="p-col-12 p-md-6">

                        <div *ngFor="let item of selectedWorks">
                            {{ getWorksItem(item)?.name }}
                        </div>

                    </div>

                </div>
                <div class="clearfix"></div><br>

                <button pButton pRipple icon="pi pi-pencil" label="modifica Appuntamento"
                    class="p-button p-button-success p-mr-2"
                    [routerLink]="['/admin/appointments/edit', appointment.id]"></button>

            </p-card>
        </div>
        <div class="clearfix"></div><br>
        <div class="clearfix"></div>
        <div class="p-col-12 p-md-12">

            <p-card>
                <strong>{{ getCategoryItem(appointment.category_id)?.name }}
                    {{ getCategoryItem(appointment.category_id)?.surname }}</strong>

                <p>{{ getCategoryItem(appointment.category_id)?.address }}<br>
                    {{ getCategoryItem(appointment.category_id)?.zip }} -
                    {{ getCategoryItem(appointment.category_id)?.city }}
                    ({{ getCategoryItem(appointment.category_id)?.province }})<br>
                </p>
                <hr>
                <p>{{ getCategoryItem(appointment.category_id)?.phone }}<br>
                    {{ getCategoryItem(appointment.category_id)?.email }}</p>
                <div class="clearfix"></div>
                <div class="clearfix"></div><br>

                <button pButton pRipple icon="pi pi-pencil" label="Modifica Dati Cliente"
                    class="p-button p-button-primary p-mr-2"
                    [routerLink]="['/admin/clients/edit', appointment.category_id]"></button>
            </p-card>
        </div>

    </ng-template>

</p-sidebar>