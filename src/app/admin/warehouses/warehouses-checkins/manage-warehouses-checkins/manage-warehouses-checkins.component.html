<p-sidebar #op [(visible)]="displayFilter" position="right" [style]="{width:'400px'}">
    <ng-template pTemplate>

        <div class="p-field p-grid">
            <div class="p-col-12">
                <p-calendar [(ngModel)]="nameFilter" [style]="{ width: '100%' }" placeholder="Data da" dateFormat="yy-mm-dd" dataType="string" inputId="dateformat"></p-calendar>
            </div>
        </div>
        <div class="p-field p-grid">
            <div class="p-col-12">
                <p-calendar [(ngModel)]="descriptionFilter" [style]="{ width: '100%' }" placeholder="Data a" dateFormat="yy-mm-dd" dataType="string" inputId="dateformat"></p-calendar>
            </div>
        </div>

        <div class="p-field p-grid">
            <div class="p-col-6">
                <button pButton type="reset" class="p-button p-button-secondary btn-block" label="annulla" (click)="reset()">
                </button>
            </div>

            <div class="p-col-6">
                <button pButton type="submit" class="p-button p-button-primary btn-block" label="cerca" (click)="load()">
                </button>
            </div>

        </div>

    </ng-template>
</p-sidebar>
<app-topnav></app-topnav>

<div class="top-main-wrapper">

    <div class="dash-header">
        <div class="dash-title">

            <div class="p-field p-grid">
                <div class="p-col-12 p-md-6">
                    <h3>Maggazzino / Ingresso</h3>

                </div>
                <div class="p-col-12 p-md-6">

                    <button type="text" pButton label="Filter" icon="pi pi-filter" class="p-button p-button-options p-mr-2 pull-right" (click)="displayFilter = true"></button>
                    <!--
                        <button type="button" pButton pRipple icon="pi pi-file-pdf" label="Esporta"
                        (click)="exportPdf()" class="p-button-options p-mr-2 pull-right"
                        tooltipPosition="bottom"></button>

                        <button type="button" pButton pRipple icon="pi pi-file-pdf" label="Esporta XLS" (click)="exportExcel()"
                        class="p-button-options p-mr-2 pull-right" tooltipPosition="bottom"></button> -->
                </div>
            </div>
        </div>
    </div>
</div>

<div class="main-inner">

    <div class="p-field p-grid">

        <div class="p-col-12 p-md-4">
            <p-card>

                <p-tabView class="responsive-tab-view">

                    <p-tabPanel header="{{pageTitle}}">

                        <form [formGroup]="blogForm" (ngSubmit)="onSubmit()">

                            <div class="p-field p-grid">
                                <div class="p-col-12 p-md-12">

                                    <label>Maggazzino</label>
                                </div>
                                <div class="p-col-12 p-md-12">
                                    <p-dropdown [options]="warehouses" [required]="true" [showClear]="true" placeholder="Scegli" [style]="{ width: '100%' }" [(ngModel)]="selectedWarehouse" formControlName="warehouse_id" optionLabel="title" optionValue="id">
                                        <ng-template let-option pTemplate="item">
                                            {{option.title}}
                                        </ng-template>
                                    </p-dropdown>
                                </div>
                            </div>

                            <div class="p-field p-grid">
                                <div class="p-col-12 p-md-12">

                                    <label>Fornitore</label>
                                </div>
                                <div class="p-col-12 p-md-12">
                                    <p-dropdown [options]="suppliers" [required]="true" [showClear]="true" placeholder="Scegli" [style]="{ width: '100%' }" [(ngModel)]="selectedSupplier" formControlName="supplier_id" optionLabel="company_name" optionValue="id">
                                        <ng-template let-option pTemplate="item">
                                            {{option.company_name}}
                                        </ng-template>
                                    </p-dropdown>
                                </div>
                            </div>

                            <div class="p-field p-grid">
                                <div class="p-col-12 p-md-12">

                                    <label>Prodotto</label>
                                </div>
                                <div class="p-col-12 p-md-12">

                                    <p-autoComplete [dropdown]="true" placeholder="Cerca per Codice, titolo, Codice interno" [style]="{ width: '100%' }" [suggestions]="filteredProductsVariations" (completeMethod)="filterCountry($event)" field="id" (onSelect)="change($event)" (onClear)="dataSelect = null"
                                        [ngModelOptions]="{standalone: true}" [(ngModel)]="dataSelect" [minLength]="1">
                                        <ng-template let-productsVariation pTemplate="item">
                                            <div class="p-grid">
                                                <div class="p-col-9">
                                                    <strong>{{productsVariation.code}}</strong><br> {{productsVariation.title}} -
                                                    <p class="truncate">{{productsVariation.description}}
                                                    </p>
                                                </div>
                                                <div class="p-col-3">
                                                    <div class="p-grid">
                                                        <div class="p-col-12">
                                                            <p-tag class="pull-right" [value]="productsVariation.price  | currency :'EUR':'symbol':'1.2-2'">
                                                            </p-tag>
                                                        </div>
                                                        <div class="p-col-12 p-mt-2">
                                                            <p class="pull-right">
                                                                <strong>{{productsVariation.pieces}}</strong> pz
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </ng-template>
                                    </p-autoComplete>

                                    <input type="hidden" pInputText [(ngModel)]="dataSelectTrue" formControlName="product_id">
                                </div>
                            </div>

                            <div class="p-field p-grid">
                                <div class="p-col-12 p-md-6">

                                    <label>Pezzi <span class="required">*</span></label>

                                    <input type="text" pInputText [style]="{width:'100%'}" formControlName="pieces" />

                                </div>

                                <div class="p-col-12 p-md-6">

                                    <label>Colli <span class="required">*</span></label>

                                    <input type="text" pInputText [style]="{width:'100%'}" formControlName="boxes" />

                                </div>
                            </div>

                            <div class="form-group form-row">
                                <label class="col-md-3"></label>
                                <div class="col-md-9">
                                    <input type="hidden" formControlName="id">
                                    <input type="hidden" formControlName="user_id" value="{{currentUser.user_id}}">
                                </div>
                            </div>

                            <div class="p-field p-grid">

                                <div class="p-col-12 p-md-12">

                                    <button pButton pRipple icon="pi pi-save" label="aggiungi prodotto" class="p-button p-button-primary btn-block" [disabled]="!blogForm.valid"></button>
                                </div>
                            </div>

                        </form>

                        <div *ngIf="dataSelectTrue">
                            <h4>Prodotto selezionato</h4>

                            <div *ngFor="let item of filteredProductsVariations">
                                <div class="p-grid">
                                    <div class="p-col-4">
                                        <img [src]="item.image" class="img-responsive">

                                    </div>
                                    <div class="p-col-8">

                                        <strong>{{item.title}}</strong><br>
                                        <p class="detail">Codice: {{item.code}}</p>
                                        <p class="detail">Codice Interno: {{item.code_int}}</p>
                                    </div>
                                </div>

                            </div>

                        </div>
                    </p-tabPanel>

                </p-tabView>
            </p-card>
        </div>


        <div class="p-col-12 p-md-8">

            <div class="p-fluid">
                <div class="p-field p-grid">
                    <div class="p-col-12 p-md-12">

                        <p-card>
                            <div class="filter-options">

                                <div class="p-field p-grid">

                                    <div class="p-col-12 p-md-8">
                                        <div class="item-size pull-left">
                                            <span class="filter-tag" *ngIf="nameFilter">{{nameFilter}} <span
                                                    class="close"><i class="pi pi-times" (click)="reset()"></i></span>
                                            </span>
                                            <span class="filter-tag" *ngIf="descriptionFilter">{{descriptionFilter}}
                                                <span class="close"><i class="pi pi-times" (click)="reset()"></i></span>
                                            </span>
                                        </div>
                                    </div>

                                    <div class="p-col-12 p-md-4">
                                        <span class="count-item pull-right">{{count}} Items</span>
                                    </div>
                                </div>
                            </div>

                            <div *ngFor=" let warehouseCheckin of warehouseCheckins  | paginate: { itemsPerPage: pageSize, currentPage: page, totalItems: count }; let i = index">
                            </div>

                            <p-table #dt [columns]="cols" [responsive]="false" [resizableColumns]="true" [autoLayout]="true" [value]="warehouseCheckins" [paginator]="false" [rows]="10" [totalRecords]="totalRecords">

                                <ng-template pTemplate="header" let-columns>
                                    <tr>
                                        <th width="100"></th>
                                        <th width="200">
                                            Entrata
                                        </th>

                                        <th width="150">
                                            Pezzi
                                        </th>

                                        <th>
                                            Prodotto
                                        </th>
                                        <th width="150"></th>
                                    </tr>

                                </ng-template>
                                <ng-template pTemplate="body" let-warehouseCheckin>
                                    <tr>
                                        <td>
                                            <p-tag severity="success" value="Entrata"></p-tag>
                                        </td>
                                        <td>
                                            <i class="pi pi-calendar"></i> {{warehouseCheckin.created_at}}

                                        </td>
                                        <td>

                                            <p-tag severity="default" [value]="warehouseCheckin.pieces + ' pezzi'">
                                            </p-tag>

                                        </td>

                                        <!--   <td>
                                {{ getWarehouseItem(warehouseCheckin.project_id)?.title }}

                                {{warehouseCheckin.warehouse_id.title}}</td>-->

                                        <td>

                                            <p class="small"><strong>{{ warehouseCheckin.product.code_int}}</strong></p>
                                            <p class="small" *ngIf="warehouseCheckin.supplier_id">
                                                {{ warehouseCheckin.supplier_id.company_name}}</p>
                                        </td>

                                        <td class="action">

                                            <!--   <button pButton pRipple icon="pi pi-pencil"
                                class="p-button p-button-success p-mr-2"
                                (click)="editItem(warehouseCheckin)"></button> -->

                                            <button pButton pRipple icon="pi pi-eye" class="p-button p-button-primary p-mr-2" (click)="view(warehouseCheckin)"></button>

                                            <button pButton pRipple icon="pi pi-trash" class="p-button p-button-danger p-mr-2" (click)="onDelete(warehouseCheckin.id)"></button>

                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                            <div class="p-grid">

                                <div class="p-col-12 p-md-12">
                                    <pagination-controls previousLabel="Prev" nextLabel="Next" responsive="true" (pageChange)="handlePageChange($event)">
                                    </pagination-controls>
                                </div>
                            </div>

                        </p-card>
                    </div>
                </div>
            </div>
        </div>


    </div>
</div>

<p-sidebar [(visible)]="productDialogAdd" position="right" [style]="{width:'50vw'}">
    <ng-template pTemplate="content">
        <div class="p-col-12 p-md-12">

        </div>
    </ng-template>
</p-sidebar>

<p-sidebar [(visible)]="productDialog" position="right" [style]="{width:'50vw'}">
    <ng-template pTemplate="content">
        <div class="p-col-12 p-md-12">
            <p-tag [value]="warehouseCheckin.id" severity="success" class="p-mr-2"></p-tag>
            <p-tag [value]="warehouseCheckin.created_at"></p-tag><br><br>
            <h3>Dettaglio Ingresso Magazzino</h3>

            <hr class="full">
            <p-card header="{{warehouseCheckin.warehouse_id.title}}">
                <div class="p-grid">
                    <div class="p-col-12 p-md-8">
                        Pezzi registrati entrata<br>

                    </div>
                    <div class="p-col-12 p-md-4">
                        <p-tag [value]="warehouseCheckin.pieces" severity="default" class="p-mr-2 pull-right">
                        </p-tag>

                    </div>

                </div>
                <div class="p-grid">
                    <div class="p-col-12 p-md-12">
                        <hr class="small">
                    </div>
                </div>

                <div class="p-grid">
                    <div class="p-col-12 p-md-8">
                        Pezzi attualmente disponibili<br>

                    </div>
                    <div class="p-col-12 p-md-4">
                        <p-tag [value]="product.pieces" severity="success" class="p-mr-2 pull-right"></p-tag>

                    </div>

                </div>
            </p-card>

            <p-card header="Prodotto">
                <div class="p-grid">
                    <div class="p-col-2 p-md-2">

                        <img *ngIf="product.image" class="img-responsive" src="{{ product.image}}">
                    </div>
                    <div class="p-col-10 p-md-10">

                        <h3>{{ product.title}}</h3>
                        <p [innerHTML]="product.description"></p>
                        <p class="small">{{ product.code_int}} - {{ product.code}}</p>

                        <div class="clearfix"></div>
                        <br>
                        <button pButton pRipple icon="pi pi-pencil" label="modifica" class="p-button p-button-primary p-mr-2" [routerLink]="['/admin/products-variation/edit', product.product_id, product.id ]"></button>
                    </div>
                </div>
            </p-card>

        </div>
    </ng-template>

</p-sidebar>
{{error}}

<p-confirmDialog [style]="{width: '50vw'}" [baseZIndex]="10000" rejectButtonStyleClass="p-button-text" #cd>

    <p-footer>
        <button type="button" pButton icon="fa fa-close" class="p-button p-button-danger p-mr-2" label="No" (click)="cd.reject()"></button>
        <button type="button" pButton icon="fa fa-check" class="p-button p-button-success p-mr-2" label="Si" (click)="cd.accept()"></button>
    </p-footer>

</p-confirmDialog>