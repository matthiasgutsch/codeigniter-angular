<p-sidebar [(visible)]="filterSidebar" #op position="right">
    <ng-template pTemplate>
        <div class="p-field p-grid">
            <div class="p-col-12">
                <p-calendar [(ngModel)]="nameFilter" [style]="{ width: '100%' }" placeholder="Data da"
                    dateFormat="yy-mm-dd" dataType="string" inputId="dateformat"></p-calendar>
            </div>
        </div>
        <div class="p-field p-grid">
            <div class="p-col-12">
                <p-calendar [(ngModel)]="descriptionFilter" [style]="{ width: '100%' }" placeholder="Data a"
                    dateFormat="yy-mm-dd" dataType="string" inputId="dateformat"></p-calendar>
            </div>
        </div>

          <div class="p-field p-grid">
            <div class="p-col-6">
                <button pButton type="reset" class="p-button p-button-secondary btn-block"
                label="annulla" (click)="reset()">
            </button>
            </div>

            <div class="p-col-6">
                <button pButton type="submit" class="p-button p-button-primary btn-block"
                label="cerca" (click)="load()">
            </button>
            </div>

        </div>
    </ng-template>
</p-sidebar>

<app-topnav></app-topnav>


<div class="top-main-wrapper">

    <div class="dash-header">
        <div class="dash-title">

            <div class="p-field p-grid">
                <div class="p-col-6 p-md-6">
                    <h3>Appuntamenti</h3>
                </div>
                <div class="p-col-6 p-md-6">
                    <button pButton pRipple icon="pi pi-plus" [routerLink]="['/admin/appointments/create']"
                        label="Aggiungi" class="p-button p-button-primary pull-right"></button>

                        <button pButton pRipple icon="pi pi-calendar" [routerLink]="['/admin/appointments/calendar']"
                        label="Calendario" class="p-button p-button-secondary pull-right p-mr-2"></button>

                    <!--  <button type="button" pButton pRipple icon="pi pi-file-pdf" label="Esporta" (click)="exportPdf()"
                        class="p-button-options p-mr-2 pull-right"  tooltipPosition="bottom"></button> -->
                    <button type="text" pButton label="Filter" icon="pi pi-filter"
                        class="p-button p-button-options p-mr-2 pull-right" (click)="filterSidebar = true"></button>

                </div>
            </div>

        </div>
    </div>
</div>
<div class="main-inner">

    <div class="p-fluid">
        <div class="p-field p-grid">
            <div class="p-col-12 p-md-12">

                <p-card>
                    <div class="filter-options">

                        <div class="p-field p-grid">

                            <div class="p-col-12 p-md-8">
                                <div class="item-size pull-left">
                                    <span class="filter-tag" *ngIf="nameFilter">{{nameFilter}} <span class="close"><i
                                                class="pi pi-times" (click)="reset()"></i></span> </span>
                                    <span class="filter-tag" *ngIf="descriptionFilter">{{descriptionFilter}} <span
                                            class="close"><i class="pi pi-times" (click)="reset()"></i></span> </span>
                                </div>
                            </div>

                            <div class="p-col-12 p-md-4">
                                <span class="count-item pull-right">{{count}} Items</span>
                            </div>
                        </div>
                    </div>
                    <div
                        *ngFor=" let appointment of appointments  | paginate: { itemsPerPage: pageSize, currentPage: page, totalItems: count }; let i = index">
                    </div>

                    <p-table #dt [value]="appointments" [pageLinks]="3" [responsive]="true" [paginator]="false"
                        [rows]="15">

                        <ng-template pTemplate="header">
                            <tr>

                                <th width="150px">Data

                                </th>

                                <th width="100px">Ora

                                </th>
                                <th>Tipo Intervento

                                </th>
                                <th width="50">Data

                                </th>
                                <th>Utente</th>
                                <th>Residenza</th>

                                <th>Action</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-appointment>
                            <tr>
                                <td><strong>{{appointment.date}}</strong><br>
                                <td>

                                    <p-tag value="{{appointment.time}}" severity="warning"></p-tag>

                                </td>
                                <td> {{appointment.title}}</td>

                                <td width="50">
                                    <app-initials-avatar (click)="editProduct(appointment)"
                                        firstName="{{ appointment.client.name | slice:0:1}}"
                                        lastName="{{ appointment.client.surname | slice:0:1}}">
                                    </app-initials-avatar>
                                </td>
                                <td>

                                    {{ appointment.client.name }}
                                    {{ appointment.client.surname }}
                                </td>

                                <td>

                                    {{ appointment.client.city }}
                                </td>

                                <td class="action">
                                    <button pButton pRipple icon="pi pi-pencil" class="p-button p-button-success p-mr-2"
                                        [routerLink]="['/admin/appointments/edit', appointment.id]"></button>
                                    <button pButton pRipple icon="pi pi-eye" class="p-button p-button-info p-mr-2"
                                        (click)="editProduct(appointment)"></button>
                                    <button pButton pRipple icon="pi pi-trash" class="p-button p-button-danger p-mr-2"
                                        (click)="onDelete(appointment.id)"></button>

                                </td>
                            </tr>
                        </ng-template>
                    </p-table>

                    <div class="p-grid">

                        <div class="p-col-12 p-md-12">
                            <pagination-controls previousLabel="Prev" nextLabel="Next" responsive="true"
                                (pageChange)="handlePageChange($event)">
                            </pagination-controls>
                        </div>
                    </div>
                </p-card>
            </div>
        </div>
    </div>

</div>

<p-sidebar [(visible)]="productDialog" position="right" [style]="{width:'50%'}">
    <ng-template pTemplate="content">
        <div class="p-col-12 p-md-12">
            <p-card>
                <div class="p-grid">
                    <div class="p-col-12 p-md-12">
                        <div class="p-grid">
                            <div class="p-col-12 p-md-6">

                                <h3>{{appointment.title}}</h3>
                            </div>

                            <div class="p-col-12 p-md-6">

                                <p-tag [value]="appointment.date" class="p-mr-2 pull-right"></p-tag>
                                <p-tag [value]="appointment.time" severity="info" class="p-mr-2  pull-right"></p-tag>
                            </div>

                        </div>
                        <hr class="small">

                    </div>
                </div>
                <div class="p-grid">

                    <div class="p-col-12 p-md-6">

                        {{ appointment.client.name }}
                        <br> {{ appointment.client.surname }}

                        <p [innerHTML]="appointment.description"></p>

                    </div>
                    <div class="p-col-12 p-md-6">

                        <div *ngFor="let item of selectedWorks">
                            {{ getWorksItem(item)?.name }}
                        </div>

                    </div>

                </div>
                <div class="clearfix"></div><br>

                <button pButton pRipple icon="pi pi-pencil" label="modifica Appuntamento"
                    class="p-button p-button-success p-mr-2"
                    [routerLink]="['/admin/appointments/edit', appointment.id]"></button>

            </p-card>
        </div>
        <div class="clearfix"></div><br>
        <div class="clearfix"></div>
        <div class="p-col-12 p-md-12">

            <p-card>
                <strong>{{ appointment.client.name }}
                    {{ appointment.client.surname }}</strong>

                <p>{{ appointment.client.address  }}<br>
                    {{ appointment.client.zip }} -
                    {{ appointment.client.city }}
                    ({{ appointment.client.province }})<br>
                </p>
                <hr>
                <p>{{ appointment.client.phone }}<br>
                    {{ appointment.client.email }}</p>
                <div class="clearfix"></div><br>

                <button pButton pRipple icon="pi pi-pencil" label="Modifica Dati Cliente"
                    class="p-button p-button-primary p-mr-2"
                    [routerLink]="['/admin/clients/edit', appointment.category_id]"></button>
            </p-card>
        </div>

    </ng-template>

</p-sidebar>

{{error}}

<p-confirmDialog [style]="{width: '50vw'}" [baseZIndex]="10000" rejectButtonStyleClass="p-button-text" #cd>

    <p-footer>
        <button type="button" pButton icon="fa fa-close" class="p-button p-button-danger p-mr-2" label="No"
            (click)="cd.reject()"></button>
        <button type="button" pButton icon="fa fa-check" class="p-button p-button-success p-mr-2" label="Si"
            (click)="cd.accept()"></button>
    </p-footer>

</p-confirmDialog>

<!-- <ngx-spinner
      bdColor="rgba(51,51,51,0.2)"
      size="medium"
      color="#fff"
      type="ball-scale-multiple"
    >
    </ngx-spinner> -->